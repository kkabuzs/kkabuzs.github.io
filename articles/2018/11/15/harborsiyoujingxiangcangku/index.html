<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Harbor私有镜像仓库 | kkabuzs博客屋</title><meta name="author" content="Kkabuzs"><meta name="copyright" content="Kkabuzs"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。  Harbor私有镜像仓库一，Harbor简介  Harbor可帮助用户迅速搭建企业级注册服务。它提供了管理图形界面，基于角色的访问控制（Role Based Access Control），镜像远程复制（同步），AD&#x2F;LDAP集成，以及审计">
<meta property="og:type" content="article">
<meta property="og:title" content="Harbor私有镜像仓库">
<meta property="og:url" content="https://kkabuzs.github.io/articles/2018/11/15/harborsiyoujingxiangcangku/index.html">
<meta property="og:site_name" content="kkabuzs博客屋">
<meta property="og:description" content="无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。  Harbor私有镜像仓库一，Harbor简介  Harbor可帮助用户迅速搭建企业级注册服务。它提供了管理图形界面，基于角色的访问控制（Role Based Access Control），镜像远程复制（同步），AD&#x2F;LDAP集成，以及审计">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kkabuzs.github.io/themes-img/touxiang.jpg">
<meta property="article:published_time" content="2018-11-15T08:26:48.000Z">
<meta property="article:modified_time" content="2025-08-28T09:01:22.265Z">
<meta property="article:author" content="Kkabuzs">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kkabuzs.github.io/themes-img/touxiang.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Harbor私有镜像仓库",
  "url": "https://kkabuzs.github.io/articles/2018/11/15/harborsiyoujingxiangcangku/",
  "image": "https://kkabuzs.github.io/themes-img/touxiang.jpg",
  "datePublished": "2018-11-15T08:26:48.000Z",
  "dateModified": "2025-08-28T09:01:22.265Z",
  "author": [
    {
      "@type": "Person",
      "name": "Kkabuzs",
      "url": "https://kkabuzs.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/themes-img/touxiang.jpg"><link rel="canonical" href="https://kkabuzs.github.io/articles/2018/11/15/harborsiyoujingxiangcangku/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Harbor私有镜像仓库',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/themes-img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/themes-img/yinhe.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/themes-img/touxiang.jpg" alt="Logo"><span class="site-name">kkabuzs博客屋</span></a><a class="nav-page-title" href="/"><span class="site-name">Harbor私有镜像仓库</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Harbor私有镜像仓库</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2018-11-15T08:26:48.000Z" title="发表于 2018-11-15 16:26:48">2018-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-28T09:01:22.265Z" title="更新于 2025-08-28 17:01:22">2025-08-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%B9%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96/">容器自动化</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><em>无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。</em><br><em>坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。</em></p>
</blockquote>
<h1 id="Harbor私有镜像仓库"><a href="#Harbor私有镜像仓库" class="headerlink" title="Harbor私有镜像仓库"></a>Harbor私有镜像仓库</h1><h2 id="一，Harbor简介"><a href="#一，Harbor简介" class="headerlink" title="一，Harbor简介"></a>一，Harbor简介</h2><ul>
<li><input checked="" disabled="" type="checkbox"> Harbor可帮助用户迅速搭建企业级注册服务。它提供了管理图形界面，基于角色的访问控制（Role Based Access Control），镜像远程复制（同步），AD&#x2F;LDAP集成，以及审计日志等企业用户需求的功能，同时还原生支持中文。</li>
<li><input checked="" disabled="" type="checkbox"> 该项目自推出以来，在Github获得了超过3300多个star和900多个forks。</li>
</ul>
<h3 id="1-1-基于角色的访问控制"><a href="#1-1-基于角色的访问控制" class="headerlink" title="1.1 基于角色的访问控制"></a>1.1 基于角色的访问控制</h3><blockquote>
<p>用户与Docker镜像仓库通过“项目”进行组织管理，一个用户可以对多个镜像仓库在同一命名空间（project）里有不同的权限。</p>
</blockquote>
<h3 id="1-2-图形化用户界面"><a href="#1-2-图形化用户界面" class="headerlink" title="1.2 图形化用户界面"></a>1.2 图形化用户界面</h3><blockquote>
<p>用户可以通过浏览器来浏览，检索当前Docker镜像仓库，管理项目和命名空间</p>
</blockquote>
<h3 id="1-3-审计管理"><a href="#1-3-审计管理" class="headerlink" title="1.3 审计管理"></a>1.3 审计管理</h3><blockquote>
<p>所有针对镜像仓库的操作都可以被记录追溯，用于审计管理。</p>
</blockquote>
<h3 id="1-4-国际化"><a href="#1-4-国际化" class="headerlink" title="1.4 国际化"></a>1.4 国际化</h3><blockquote>
<p>基于英文与中文语言进行了本地化。可以增加更多的语言支持。</p>
</blockquote>
<h3 id="1-5-RESTful-API"><a href="#1-5-RESTful-API" class="headerlink" title="1.5 RESTful API"></a>1.5 RESTful API</h3><blockquote>
<p>提供给管理员对于Harbor更多的操控，使得与其他管理软件集成变得更容易。</p>
</blockquote>
<h3 id="1-6-LDAP认证"><a href="#1-6-LDAP认证" class="headerlink" title="1.6 LDAP认证"></a>1.6 LDAP认证</h3><h3 id="1-7-镜像复制"><a href="#1-7-镜像复制" class="headerlink" title="1.7 镜像复制"></a>1.7 镜像复制</h3><blockquote>
<p>基于策略的Docker镜像复制功能，可在不同的数据中心，不同的运行环境之间同步镜像，并提供有好的管理界面，大大简化了实际运维中的镜像管理工作。</p>
</blockquote>
<h3 id="1-8-与Clair集成"><a href="#1-8-与Clair集成" class="headerlink" title="1.8 与Clair集成"></a>1.8 与Clair集成</h3><blockquote>
<p>与Clair集成，添加漏洞扫描功能。Clair是coreos开源的容器漏洞扫描工具，在容器逐渐普及的今天，容器镜像安全问题日益严重。Clair是目前少数的开源安全扫描工具。</p>
</blockquote>
<h3 id="1-9-Notary签名工具"><a href="#1-9-Notary签名工具" class="headerlink" title="1.9 Notary签名工具"></a>1.9 Notary签名工具</h3><blockquote>
<p>Notary是Docker镜像的签名工具，用来保证镜像在pull，push和传输工程中的一致性和完整性，避免中间人攻击，避免非法的镜像更新和运行。</p>
</blockquote>
<h2 id="二，为Harbor签发域名证书"><a href="#二，为Harbor签发域名证书" class="headerlink" title="二，为Harbor签发域名证书"></a>二，为Harbor签发域名证书</h2><blockquote>
<p>openssl是目前最流行的SSL密码库工具，提供了一个通用，功能完备的工具套件，用以支持SSL&#x2F;TLS协议的实现。<br>官网：<a target="_blank" rel="noopener" href="https://www.openssl.org/source/">https://www.openssl.org/source/</a></p>
</blockquote>
<p><strong>环境准备</strong></p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>ip</th>
<th>用途</th>
<th>最小资源配比</th>
<th>最佳资源配比</th>
</tr>
</thead>
<tbody><tr>
<td>harbor-master</td>
<td>192.168.200.103</td>
<td>harbor私有镜像仓库</td>
<td>2CPU</td>
<td>4CPU</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>4G mem</td>
<td>8G mem</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor-master ~]# hostname -I</span><br><span class="line">192.168.200.103 </span><br><span class="line">[root@harbor-master ~]# <span class="built_in">uname</span> -r</span><br><span class="line">3.10.0-862.el7.x86_64</span><br><span class="line">[root@harbor-master ~]# <span class="built_in">cat</span> /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.5.1804 (Core) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>官方文档<a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/blob/master/docs/configure_https.md">https://github.com/goharbor/harbor/blob/master/docs/configure_https.md</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建自己的CA证书</span></span><br><span class="line">[root@harbor-master ~]# <span class="built_in">mkdir</span> -p /data/ssl</span><br><span class="line">[root@harbor-master ~]# <span class="built_in">cd</span> /data/ssl/</span><br><span class="line">[root@harbor-master ssl]# <span class="built_in">which</span> openssl</span><br><span class="line">/usr/bin/openssl</span><br><span class="line">[root@harbor-master ssl]# openssl req -newkey rsa:4096 -nodes -sha256 -keyout ca.key -x509 -days 365 -out ca.crt</span><br><span class="line">Generating a 4096 bit RSA private key</span><br><span class="line">..................................................................++</span><br><span class="line">.................................................++</span><br><span class="line">writing new private key to <span class="string">&#x27;ca.key&#x27;</span></span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN        <span class="comment">#国家的名字</span></span><br><span class="line">State or Province Name (full name) []:Beijing       <span class="comment">#城市名字</span></span><br><span class="line">Locality Name (eg, city) [Default City]:Beijing</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:yunjisuan     <span class="comment">#公司名字</span></span><br><span class="line">Organizational Unit Name (eg, section) []:yunjisuan</span><br><span class="line">Common Name (eg, your name or your server<span class="string">&#x27;s hostname) []:www.yunjisuan.com      #域名</span></span><br><span class="line"><span class="string">Email Address []:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#生成签名证书请求</span></span><br><span class="line"><span class="string">[root@harbor-master ssl]# openssl req -newkey  rsa:4096 -nodes -sha256 -keyout www.yunjisuan.com.key -out www.yunjisuan.com.csr</span></span><br><span class="line"><span class="string">Generating a 4096 bit RSA private key</span></span><br><span class="line"><span class="string">...................................................++</span></span><br><span class="line"><span class="string">....++</span></span><br><span class="line"><span class="string">writing new private key to &#x27;</span>www.yunjisuan.com.key<span class="string">&#x27;</span></span><br><span class="line"><span class="string">-----</span></span><br><span class="line"><span class="string">You are about to be asked to enter information that will be incorporated</span></span><br><span class="line"><span class="string">into your certificate request.</span></span><br><span class="line"><span class="string">What you are about to enter is what is called a Distinguished Name or a DN.</span></span><br><span class="line"><span class="string">There are quite a few fields but you can leave some blank</span></span><br><span class="line"><span class="string">For some fields there will be a default value,</span></span><br><span class="line"><span class="string">If you enter &#x27;</span>.<span class="string">&#x27;, the field will be left blank.</span></span><br><span class="line"><span class="string">-----</span></span><br><span class="line"><span class="string">Country Name (2 letter code) [XX]:CN</span></span><br><span class="line"><span class="string">State or Province Name (full name) []:Beijing</span></span><br><span class="line"><span class="string">Locality Name (eg, city) [Default City]:Beijing</span></span><br><span class="line"><span class="string">Organization Name (eg, company) [Default Company Ltd]:yunjisuan</span></span><br><span class="line"><span class="string">Organizational Unit Name (eg, section) []:yunjisuan</span></span><br><span class="line"><span class="string">Common Name (eg, your name or your server&#x27;</span>s hostname) []:www.yunjisuan.com</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">Please enter the following <span class="string">&#x27;extra&#x27;</span> attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成注册表主机的证书</span></span><br><span class="line">[root@harbor-master ssl]# openssl x509 -req -days 365 -<span class="keyword">in</span> www.yunjisuan.com.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out www.yunjisuan</span><br><span class="line">.com.crt</span><br><span class="line">Signature ok</span><br><span class="line">subject=/C=CN/ST=Beijing/L=Beijing/O=yunjisuan/OU=yunjisuan/CN=www.yunjisuan.com</span><br><span class="line">Getting CA Private Key</span><br><span class="line">[root@harbor-master ssl]# ll</span><br><span class="line">total 24</span><br><span class="line">-rw-r--r--. 1 root root 2049 Jan 14 23:45 ca.crt</span><br><span class="line">-rw-r--r--. 1 root root 3272 Jan 14 23:45 ca.key</span><br><span class="line">-rw-r--r--. 1 root root   17 Jan 15 00:00 ca.srl</span><br><span class="line">-rw-r--r--. 1 root root 1931 Jan 15 00:00 www.yunjisuan.com.crt</span><br><span class="line">-rw-r--r--. 1 root root 1716 Jan 14 23:56 www.yunjisuan.com.csr</span><br><span class="line">-rw-r--r--. 1 root root 3272 Jan 14 23:56 www.yunjisuan.com.key</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="三，信任自签发的域名证书"><a href="#三，信任自签发的域名证书" class="headerlink" title="三，信任自签发的域名证书"></a>三，信任自签发的域名证书</h2><blockquote>
<p>由于CA证书是我们自己签发的，linux操作系统是不信任的   ，因此，需要把证书加到系统的信任证书里。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将自签ca证书添加到系统信任</span></span><br><span class="line">[root@harbor-master ssl]# <span class="built_in">pwd</span></span><br><span class="line">/data/ssl</span><br><span class="line">[root@harbor-master ssl]# <span class="built_in">cp</span> www.yunjisuan.com.crt /etc/pki/ca-trust/source/anchors/</span><br><span class="line"></span><br><span class="line"><span class="comment">#让ca认证立刻生效</span></span><br><span class="line">[root@harbor-master ssl]# update-ca-trust <span class="built_in">enable</span></span><br><span class="line">[root@harbor-master ssl]# update-ca-trust extract</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>让证书立刻生效之后，要重启docker服务，否则无效。</p>
</blockquote>
<h2 id="四，Harbor-1-4-版本配置与安装"><a href="#四，Harbor-1-4-版本配置与安装" class="headerlink" title="四，Harbor 1.4 版本配置与安装"></a>四，Harbor 1.4 版本配置与安装</h2><h3 id="4-1-安装docker-ce社区版"><a href="#4-1-安装docker-ce社区版" class="headerlink" title="4.1 安装docker-ce社区版"></a>4.1 安装docker-ce社区版</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor-master ~]# sestatus </span><br><span class="line">SELinux status:                 disabled</span><br><span class="line"><span class="comment">#安装依赖包</span></span><br><span class="line">[root@harbor-master ~]# yum -y install yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加docker的CE版本的yum源配置文件</span></span><br><span class="line">[root@harbor-master ~]# curl https://download.docker.com/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  2424  100  2424    0     0   2544      0 --:--:-- --:--:-- --:--:--  2543</span><br><span class="line">[root@harbor-master ~]# ll /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">-rw-r--r-- 1 root root 2424 10月 13 21:12 /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装CE版本的docker</span></span><br><span class="line">[root@harbor-master ~]# yum -y install docker-ce</span><br><span class="line">[root@harbor-master ~]# systemctl start docker      <span class="comment">#启动docker</span></span><br><span class="line">[root@harbor-master ~]# systemctl <span class="built_in">enable</span> docker     <span class="comment">#添加开机启动</span></span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@harbor-master ~]# docker version          <span class="comment">#查看docker版本</span></span><br><span class="line">Client:</span><br><span class="line"> Version:           18.06.1-ce</span><br><span class="line"> API version:       1.38</span><br><span class="line"> Go version:        go1.10.3</span><br><span class="line"> Git commit:        e68fc7a</span><br><span class="line"> Built:             Tue Aug 21 17:23:03 2018</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-下载并安装Harbor私有仓库"><a href="#4-2-下载并安装Harbor私有仓库" class="headerlink" title="4.2 下载并安装Harbor私有仓库"></a>4.2 下载并安装Harbor私有仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建harbor的证书目录，并复制</span></span><br><span class="line">[root@harbor-master ~]# <span class="built_in">mkdir</span> -p /etc/ssl/harbor</span><br><span class="line">[root@harbor-master ~]# <span class="built_in">cp</span> /data/ssl/www.yunjisuan.com.key /etc/ssl/harbor/</span><br><span class="line">[root@harbor-master ~]# <span class="built_in">cp</span> /data/ssl/www.yunjisuan.com.crt /etc/ssl/harbor/</span><br><span class="line">[root@harbor-master ~]# ll /etc/ssl/harbor/</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root 1931 Jan 15 00:16 www.yunjisuan.com.crt</span><br><span class="line">-rw-r--r-- 1 root root 3272 Jan 15 00:16 www.yunjisuan.com.key</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建harbor下载目录，并下载harbor-offline-installer-v1.5.0.tgz</span></span><br><span class="line">[root@harbor-master ~]# <span class="built_in">mkdir</span> -p /data/install</span><br><span class="line">[root@harbor-master ~]# <span class="built_in">cd</span> /data/install/</span><br><span class="line">[root@harbor-master install]# <span class="built_in">pwd</span></span><br><span class="line">/data/install</span><br><span class="line">[root@harbor-master install]# wget http://harbor.orientsoft.cn/harbor-v1.5.0/harbor-offline-installer-v1.5.0.tgz</span><br><span class="line">[root@harbor-master install]# <span class="built_in">ls</span> </span><br><span class="line">harbor-offline-installer-v1.5.0.tgz</span><br><span class="line">[root@harbor-master install]# tar xf harbor-offline-installer-v1.5.0.tgz </span><br><span class="line">[root@harbor-master install]# <span class="built_in">ls</span></span><br><span class="line">harbor  harbor-offline-installer-v1.5.0.tgz</span><br><span class="line">[root@harbor-master install]# <span class="built_in">cd</span> harbor</span><br><span class="line">[root@harbor-master harbor]# ll</span><br><span class="line">total 854960</span><br><span class="line">drwxr-xr-x 3 root root        23 Jan 15 00:58 common        <span class="comment">#模板目录</span></span><br><span class="line">-rw-r--r-- 1 root root      1185 May  2  2018 docker-compose.clair.yml</span><br><span class="line">-rw-r--r-- 1 root root      1725 May  2  2018 docker-compose.notary.yml</span><br><span class="line">-rw-r--r-- 1 root root      3596 May  2  2018 docker-compose.yml</span><br><span class="line">drwxr-xr-x 3 root root       156 May  2  2018 ha            <span class="comment">#高可用配置</span></span><br><span class="line">-rw-r--r-- 1 root root      6687 May  2  2018 harbor.cfg    <span class="comment">#harbor配置文件</span></span><br><span class="line">-rw-r--r-- 1 root root 875401338 May  2  2018 harbor.v1.5.0.tar.gz</span><br><span class="line">-rwxr-xr-x 1 root root      5773 May  2  2018 install.sh</span><br><span class="line">-rw-r--r-- 1 root root     10771 May  2  2018 LICENSE</span><br><span class="line">-rw-r--r-- 1 root root       482 May  2  2018 NOTICE</span><br><span class="line">-rwxr-xr-x 1 root root     27379 May  2  2018 prepare</span><br><span class="line">[root@harbor-master harbor]# <span class="built_in">cp</span> harbor.cfg&#123;,.bak&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改habor.cfg配置文件</span></span><br><span class="line">[root@harbor-master harbor]# <span class="built_in">cat</span> -n harbor.cfg.bak | sed -n <span class="string">&#x27;7p;11p;23p;24p;68p&#x27;</span></span><br><span class="line">     7	hostname = reg.mydomain.com     <span class="comment">#修改成证书的域名</span></span><br><span class="line">    11	ui_url_protocol = http          <span class="comment">#启用加密传输https</span></span><br><span class="line">    23	ssl_cert = /data/cert/server.crt    <span class="comment">#证书位置</span></span><br><span class="line">    24	ssl_cert_key = /data/cert/server.key    <span class="comment">#证书密钥位置</span></span><br><span class="line">    68	harbor_admin_password = Harbor12345     <span class="comment">#默认管理员及密码</span></span><br><span class="line">[root@harbor-master harbor]# <span class="built_in">cat</span> -n harbor.cfg | sed -n <span class="string">&#x27;7p;11p;23p;24p;68p&#x27;</span></span><br><span class="line">     7	hostname = www.yunjisuan.com</span><br><span class="line">    11	ui_url_protocol = https</span><br><span class="line">    23	ssl_cert = /etc/ssl/harbor/www.yunjisuan.com.crt</span><br><span class="line">    24	ssl_cert_key = /etc/ssl/harbor/www.yunjisuan.com.key</span><br><span class="line">    68	harbor_admin_password = Harbor12345</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装命令docker-compose（需要1.21版本）</span></span><br><span class="line">[root@harbor-master ~]# curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(<span class="built_in">uname</span> -s)-$(<span class="built_in">uname</span> -m) -o /usr/local/bin/docker-compose</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   617    0   617    0     0    367      0 --:--:--  0:00:01 --:--:--   367</span><br><span class="line">100 10.3M  100 10.3M    0     0   289k      0  0:00:36  0:00:36 --:--:--  573k</span><br><span class="line">[root@harbor-master ~]# ll /usr/local/bin/docker-compose </span><br><span class="line">-rw-r--r-- 1 root root 10858808 Jan 15 01:44 /usr/local/bin/docker-compose</span><br><span class="line">[root@harbor-master ~]# <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose </span><br><span class="line">[root@harbor-master ~]# <span class="built_in">which</span> docker-compose</span><br><span class="line">/usr/local/bin/docker-compose</span><br><span class="line">[root@harbor-master ~]# docker-compose --version</span><br><span class="line">docker-compose version 1.21.2, build a133471</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装harbor私有镜像仓库</span></span><br><span class="line">[root@harbor-master ~]# <span class="built_in">cd</span> /data/install/harbor</span><br><span class="line">[root@harbor-master harbor]# ./install.sh --with-notary --with-clair    <span class="comment">#--with-notary:镜像签名功能     #--with-clair:漏洞扫描功能</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看harbor启动的镜像</span></span><br><span class="line">[root@harbor-master harbor]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                                       COMMAND                  CREATED             STATUS                             PORTS                                                              NAMES</span><br><span class="line">90c62ec359ff        vmware/nginx-photon:v1.5.0                  <span class="string">&quot;nginx -g &#x27;daemon of…&quot;</span>   23 seconds ago      Up 20 seconds (health: starting)   0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp   nginx</span><br><span class="line">feaa06731077        vmware/harbor-jobservice:v1.5.0             <span class="string">&quot;/harbor/start.sh&quot;</span>       23 seconds ago      Up 8 seconds                                                                                          harbor-jobservice</span><br><span class="line">ce7a51285631        vmware/notary-server-photon:v0.5.1-v1.5.0   <span class="string">&quot;/bin/server-start.sh&quot;</span>   24 seconds ago      Up 22 seconds                                                                                         notary-server</span><br><span class="line">2f59412d3e6e        vmware/harbor-ui:v1.5.0                     <span class="string">&quot;/harbor/start.sh&quot;</span>       25 seconds ago      Up 23 seconds (health: starting)                                                                      harbor-ui</span><br><span class="line">f58ad9931c17        vmware/clair-photon:v2.0.1-v1.5.0           <span class="string">&quot;/docker-entrypoint.…&quot;</span>   25 seconds ago      Up 1 second (health: starting)     6060-6061/tcp                                                      clair</span><br><span class="line">a8c46d927e1b        vmware/notary-signer-photon:v0.5.1-v1.5.0   <span class="string">&quot;/bin/signer-start.sh&quot;</span>   26 seconds ago      Up 24 seconds                                                                                         notary-signer</span><br><span class="line">fb6de4a74c1c        vmware/postgresql-photon:v1.5.0             <span class="string">&quot;/entrypoint.sh post…&quot;</span>   27 seconds ago      Up 24 seconds (health: starting)   5432/tcp                                                           clair-db</span><br><span class="line">a233f7affef7        vmware/harbor-adminserver:v1.5.0            <span class="string">&quot;/harbor/start.sh&quot;</span>       27 seconds ago      Up 25 seconds (health: starting)                                                                      harbor-adminserver</span><br><span class="line">ea71c3eb0e26        vmware/harbor-db:v1.5.0                     <span class="string">&quot;/usr/local/bin/dock…&quot;</span>   27 seconds ago      Up 25 seconds (health: starting)   3306/tcp                                                           harbor-db</span><br><span class="line">86ea4c257b89        vmware/registry-photon:v2.6.2-v1.5.0        <span class="string">&quot;/entrypoint.sh serv…&quot;</span>   27 seconds ago      Up 24 seconds (health: starting)   5000/tcp                                                           registry</span><br><span class="line">16b6e4bdc01f        vmware/mariadb-photon:v1.5.0                <span class="string">&quot;/usr/local/bin/dock…&quot;</span>   27 seconds ago      Up 26 seconds                      3306/tcp                                                           notary-db</span><br><span class="line">e7e5425be2b3        vmware/redis-photon:v1.5.0                  <span class="string">&quot;docker-entrypoint.s…&quot;</span>   27 seconds ago      Up 26 seconds                      6379/tcp                                                           redis</span><br><span class="line">c022f1ce72dc        vmware/harbor-log:v1.5.0                    <span class="string">&quot;/bin/sh -c /usr/loc…&quot;</span>   29 seconds ago      Up 27 seconds (health: starting)   127.0.0.1:1514-&gt;10514/tcp                                          harbor-log</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>通过浏览器进行访问测试</strong></p>
<p><code>https://192.168.200.103/</code></p>
<p><img src="/articles/2018/11/15/harborsiyoujingxiangcangku/1.png"></p>
<blockquote>
<p>需要修改一下安全模式</p>
</blockquote>
<p><img src="/articles/2018/11/15/harborsiyoujingxiangcangku/2.png"></p>
<blockquote>
<p>项目创建：仅管理员<br>不允许自动注册</p>
</blockquote>
<h2 id="五，镜像管理与安全：漏洞扫描和镜像签名"><a href="#五，镜像管理与安全：漏洞扫描和镜像签名" class="headerlink" title="五，镜像管理与安全：漏洞扫描和镜像签名"></a>五，镜像管理与安全：漏洞扫描和镜像签名</h2><h3 id="5-1-添加docker国内公有镜像源"><a href="#5-1-添加docker国内公有镜像源" class="headerlink" title="5.1 添加docker国内公有镜像源"></a>5.1 添加docker国内公有镜像源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor-master harbor]# <span class="built_in">cat</span> /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>:[ <span class="string">&quot;https://registry.docker-cn.com&quot;</span> ]</span><br><span class="line">&#125;</span><br><span class="line">[root@harbor-master harbor]# systemctl daemon-reload</span><br><span class="line">[root@harbor-master harbor]# systemctl restart docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-2-重新启动harbor私有镜像仓库"><a href="#5-2-重新启动harbor私有镜像仓库" class="headerlink" title="5.2 重新启动harbor私有镜像仓库"></a>5.2 重新启动harbor私有镜像仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#让harbor修改过的配置立刻生效</span></span><br><span class="line">[root@harbor-master harbor]# ./prepare </span><br><span class="line">Clearing the configuration file: ./common/config/adminserver/env</span><br><span class="line">Clearing the configuration file: ./common/config/ui/env</span><br><span class="line">Clearing the configuration file: ./common/config/ui/app.conf</span><br><span class="line">Clearing the configuration file: ./common/config/ui/private_key.pem</span><br><span class="line">Clearing the configuration file: ./common/config/db/env</span><br><span class="line">Clearing the configuration file: ./common/config/jobservice/env</span><br><span class="line">Clearing the configuration file: ./common/config/jobservice/config.yml</span><br><span class="line">Clearing the configuration file: ./common/config/registry/config.yml</span><br><span class="line">Clearing the configuration file: ./common/config/registry/root.crt</span><br><span class="line">Clearing the configuration file: ./common/config/nginx/conf.d/notary.upstream.conf</span><br><span class="line">Clearing the configuration file: ./common/config/nginx/conf.d/notary.server.conf</span><br><span class="line">Clearing the configuration file: ./common/config/nginx/cert/www.yunjisuan.com.crt</span><br><span class="line">Clearing the configuration file: ./common/config/nginx/cert/www.yunjisuan.com.key</span><br><span class="line">Clearing the configuration file: ./common/config/nginx/nginx.conf</span><br><span class="line">Clearing the configuration file: ./common/config/log/logrotate.conf</span><br><span class="line">Clearing the configuration file: ./common/config/notary/mysql-initdb.d/initial-notarysigner.sql</span><br><span class="line">Clearing the configuration file: ./common/config/notary/mysql-initdb.d/initial-notaryserver.sql</span><br><span class="line">Clearing the configuration file: ./common/config/notary/notary-signer.crt</span><br><span class="line">Clearing the configuration file: ./common/config/notary/notary-signer.key</span><br><span class="line">Clearing the configuration file: ./common/config/notary/notary-signer-ca.crt</span><br><span class="line">Clearing the configuration file: ./common/config/notary/root.crt</span><br><span class="line">Clearing the configuration file: ./common/config/notary/signer-config.json</span><br><span class="line">Clearing the configuration file: ./common/config/notary/server-config.json</span><br><span class="line">Clearing the configuration file: ./common/config/notary/signer_env</span><br><span class="line">Clearing the configuration file: ./common/config/clair/postgresql-init.d/README.md</span><br><span class="line">Clearing the configuration file: ./common/config/clair/postgres_env</span><br><span class="line">Clearing the configuration file: ./common/config/clair/config.yaml</span><br><span class="line">Clearing the configuration file: ./common/config/clair/clair_env</span><br><span class="line">loaded secret from file: /data/secretkey</span><br><span class="line">Generated configuration file: ./common/config/nginx/nginx.conf</span><br><span class="line">Generated configuration file: ./common/config/adminserver/env</span><br><span class="line">Generated configuration file: ./common/config/ui/env</span><br><span class="line">Generated configuration file: ./common/config/registry/config.yml</span><br><span class="line">Generated configuration file: ./common/config/db/env</span><br><span class="line">Generated configuration file: ./common/config/jobservice/env</span><br><span class="line">Generated configuration file: ./common/config/jobservice/config.yml</span><br><span class="line">Generated configuration file: ./common/config/log/logrotate.conf</span><br><span class="line">Generated configuration file: ./common/config/jobservice/config.yml</span><br><span class="line">Generated configuration file: ./common/config/ui/app.conf</span><br><span class="line">Generated certificate, key file: ./common/config/ui/private_key.pem, cert file: ./common/config/registry/root.crt</span><br><span class="line">The configuration files are ready, please use docker-compose to start the service.</span><br><span class="line"></span><br><span class="line"><span class="comment">#清理所有harbor容器进程</span></span><br><span class="line">[root@harbor-master harbor]# docker-compose down</span><br><span class="line">Stopping nginx             ... <span class="keyword">done</span></span><br><span class="line">Stopping harbor-jobservice ... <span class="keyword">done</span></span><br><span class="line">Stopping harbor-ui         ... <span class="keyword">done</span></span><br><span class="line">Stopping redis             ... <span class="keyword">done</span></span><br><span class="line">Stopping harbor-log        ... <span class="keyword">done</span></span><br><span class="line">Removing nginx              ... <span class="keyword">done</span></span><br><span class="line">Removing harbor-jobservice  ... <span class="keyword">done</span></span><br><span class="line">Removing harbor-ui          ... <span class="keyword">done</span></span><br><span class="line">Removing harbor-adminserver ... <span class="keyword">done</span></span><br><span class="line">Removing harbor-db          ... <span class="keyword">done</span></span><br><span class="line">Removing registry           ... <span class="keyword">done</span></span><br><span class="line">Removing redis              ... <span class="keyword">done</span></span><br><span class="line">Removing harbor-log         ... <span class="keyword">done</span></span><br><span class="line">Removing network harbor_harbor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#后台启动所有harbor容器进程</span></span><br><span class="line">[root@harbor-master harbor]# docker-compose up -d</span><br><span class="line">Creating network <span class="string">&quot;harbor_harbor&quot;</span> with the default driver</span><br><span class="line">Creating harbor-log ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-adminserver ... <span class="keyword">done</span></span><br><span class="line">Creating redis              ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-db          ... <span class="keyword">done</span></span><br><span class="line">Creating registry           ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-ui          ... <span class="keyword">done</span></span><br><span class="line">Creating harbor-jobservice  ... <span class="keyword">done</span></span><br><span class="line">Creating nginx              ... <span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-3-下载一个公有镜像上传到harbor"><a href="#5-3-下载一个公有镜像上传到harbor" class="headerlink" title="5.3 下载一个公有镜像上传到harbor"></a>5.3 下载一个公有镜像上传到harbor</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#harbor本地下载一个公有镜像centos:7</span></span><br><span class="line">[root@harbor-master harbor]# docker pull centos</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">a02a4930cb5d: Pull complete </span><br><span class="line">Digest: sha256:184e5f35598e333bfa7de10d8fb1cebb5ee4df5bc0f970bf2b1e7c7345136426</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br><span class="line"></span><br><span class="line"><span class="comment">#本地映射私有仓库域名</span></span><br><span class="line">[root@harbor-master harbor]# <span class="built_in">tail</span> -1 /etc/hosts</span><br><span class="line">192.168.200.103 www.yunjisuan.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#将centos镜像改名并上传到私有镜像仓库</span></span><br><span class="line">[root@harbor-master harbor]# docker tag centos:latest www.yunjisuan.com/library/centos:7</span><br><span class="line">[root@harbor-master harbor]# docker images | grep centos</span><br><span class="line">centos                             latest              1e1148e4cc2c        5 weeks ago         202MB</span><br><span class="line">www.yunjisuan.com/library/centos   7                   1e1148e4cc2c        5 weeks ago         202MB</span><br><span class="line">[root@harbor-master harbor]# docker push www.yunjisuan.com/library/centos:7</span><br><span class="line">The push refers to repository [www.yunjisuan.com/library/centos]</span><br><span class="line">071d8bd76517: Preparing </span><br><span class="line">denied: requested access to the resource is denied      <span class="comment">#连接拒绝，因为还没有进行认证</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#登陆验证harbor私有镜像仓库，并上传镜像</span></span><br><span class="line">[root@harbor-master harbor]# docker login www.yunjisuan.com</span><br><span class="line">Username: admin</span><br><span class="line">Password:           <span class="comment">#密码Harbor12345</span></span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line">[root@harbor-master harbor]# docker push www.yunjisuan.com/library/centos:7</span><br><span class="line">The push refers to repository [www.yunjisuan.com/library/centos]</span><br><span class="line">071d8bd76517: Pushed </span><br><span class="line">7: digest: sha256:365fc7f33107869dfcf2b3ba220ce0aa42e16d3f8e8b3c21d72af1ee622f0cf0 size: 529</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-4-登陆浏览器查看镜像上传结果，并扫描漏洞"><a href="#5-4-登陆浏览器查看镜像上传结果，并扫描漏洞" class="headerlink" title="5.4 登陆浏览器查看镜像上传结果，并扫描漏洞"></a>5.4 登陆浏览器查看镜像上传结果，并扫描漏洞</h3><p><img src="/articles/2018/11/15/harborsiyoujingxiangcangku/3.png"><br><img src="/articles/2018/11/15/harborsiyoujingxiangcangku/4.png"><br><img src="/articles/2018/11/15/harborsiyoujingxiangcangku/5.png"></p>
<h3 id="5-5-设置镜像安全等级"><a href="#5-5-设置镜像安全等级" class="headerlink" title="5.5 设置镜像安全等级"></a>5.5 设置镜像安全等级</h3><p><img src="/articles/2018/11/15/harborsiyoujingxiangcangku/6.png"><br><img src="/articles/2018/11/15/harborsiyoujingxiangcangku/7.png"></p>
<h3 id="5-6-为docker客户端下发域名证书"><a href="#5-6-为docker客户端下发域名证书" class="headerlink" title="5.6 为docker客户端下发域名证书"></a>5.6 为docker客户端下发域名证书</h3><p>|主机名|ip|用途|最小资源配比|最佳资源配比|<br>|–|<br>|docker-client|192.168.200.105|docker客户端|||<br>|harbor-master|192.168.200.103|harbor私有镜像仓库|2CPU|4CPU|<br>||||4G mem|8G mem|</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#映射harbor私有仓库域名</span></span><br><span class="line">[root@docker-client ~]# <span class="built_in">cat</span> /etc/redhat-release </span><br><span class="line">CentOS Linux release 7.5.1804 (Core) </span><br><span class="line">[root@docker-client ~]# <span class="built_in">uname</span> -r</span><br><span class="line">3.10.0-862.el7.x86_64</span><br><span class="line">[root@docker-client ~]# hostname -I</span><br><span class="line">192.168.200.105 </span><br><span class="line">[root@docker-client ~]# <span class="built_in">cat</span> /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">192.168.200.103 www.yunjisuan.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装docker-ce社区版</span></span><br><span class="line">[root@docker-client ~]# sestatus</span><br><span class="line">SELinux status:                 disabled</span><br><span class="line">[root@docker-client ~]# systemctl stop firewalld</span><br><span class="line">[root@docker-client ~]# systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">[root@docker-client ~]# yum -y install yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">[root@docker-client ~]# curl https://download.docker.com/linux/centos/docker-ce.repo -o /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100  2424  100  2424    0     0    486      0  0:00:04  0:00:04 --:--:--   698</span><br><span class="line">[root@docker-client ~]# yum -y install docker-ce</span><br><span class="line">[root@docker-client ~]# systemctl start docker</span><br><span class="line">[root@docker-client ~]# systemctl <span class="built_in">enable</span> docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@docker-client ~]# docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:           18.09.1</span><br><span class="line"> API version:       1.39</span><br><span class="line"> Go version:        go1.10.6</span><br><span class="line"> Git commit:        4c52b90</span><br><span class="line"> Built:             Wed Jan  9 19:35:01 2019</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.09.1</span><br><span class="line">  API version:      1.39 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.6</span><br><span class="line">  Git commit:       4c52b90</span><br><span class="line">  Built:            Wed Jan  9 19:06:30 2019</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置国内镜像源</span></span><br><span class="line">[root@docker-client ~]# <span class="built_in">cat</span> /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>:[ <span class="string">&quot;https://registry.docker-cn.com&quot;</span> ]</span><br><span class="line">&#125;</span><br><span class="line">[root@docker-client ~]# systemctl daemon-reload</span><br><span class="line">[root@docker-client ~]# systemctl restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载mongo公有镜像</span></span><br><span class="line">[root@docker-client ~]# docker pull mongo</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/mongo</span><br><span class="line">b849b56b69e7: Pull complete </span><br><span class="line">42986ef25bcd: Pull complete </span><br><span class="line">d927c1b717ec: Pull complete </span><br><span class="line">15b86ea20233: Pull complete </span><br><span class="line">95dc958d65c6: Pull complete </span><br><span class="line">aec60d69dd50: Pull complete </span><br><span class="line">bf92a6681913: Pull complete </span><br><span class="line">8911fe7d4b35: Pull complete </span><br><span class="line">8ce44114b060: Pull complete </span><br><span class="line">1a944a194d13: Pull complete </span><br><span class="line">5519cf0ef45d: Pull complete </span><br><span class="line">6c688677ac8e: Pull complete </span><br><span class="line">2f147ac236bb: Pull complete </span><br><span class="line">Digest: sha256:d69e9e4d983c080cdbbafc64cbbd26373e0e417cb9cd18189eeb554c534fc26e</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mongo:latest</span><br><span class="line">[root@docker-client ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mongo               latest              7177e01e8c01        2 weeks ago         393MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#为docker客户端下发域名（在harbor本地执行）</span></span><br><span class="line"><span class="comment">#将harbor上的自签发域名证书www.yunjisuan.com.crt复制到docker客户端的对应目录下</span></span><br><span class="line">[root@harbor-master harbor]# <span class="built_in">cd</span> /data/ssl/</span><br><span class="line">[root@harbor-master ssl]# scp www.yunjisuan.com.crt 192.168.200.105:/etc/pki//ca-trust/source/anchors/</span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.200.105 (192.168.200.105)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:Tb+xKsJLCQlT4u/RS9qENMAdjnoXMLlWbowNVGcfdsg.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is MD5:68:b5:d8:28:9f:50:6d:97:1d:26:1c:ea:7e:12:3a:04.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>192.168.200.105<span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">root@192.168.200.105&#x27;</span>s password: </span><br><span class="line">www.yunjisuan.com.crt                                     100% 1931   102.2KB/s   00:00  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#在docker客户端执行，让证书立刻生效</span></span><br><span class="line">[root@docker-client ~]# update-ca-trust <span class="built_in">enable</span></span><br><span class="line">[root@docker-client ~]# update-ca-trust extract</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#下发证书重新启动docker-client的docker服务</span></span><br><span class="line">[root@docker-client ~]# systemctl restart docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#docker-client登陆docker仓库进行验证</span></span><br><span class="line">[root@docker-client ~]# docker login www.yunjisuan.com</span><br><span class="line">Username: admin</span><br><span class="line">Password:           <span class="comment">#密码：Harbor12345</span></span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改镜像名字并上传到私有仓库</span></span><br><span class="line">[root@docker-client ~]# docker tag mongo:latest www.yunjisuan.com/library/mongo</span><br><span class="line">[root@docker-client ~]# docker images</span><br><span class="line">REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mongo                             latest              7177e01e8c01        2 weeks ago         393MB</span><br><span class="line">www.yunjisuan.com/library/mongo   latest              7177e01e8c01        2 weeks ago         393MB</span><br><span class="line">[root@docker-client ~]# docker push www.yunjisuan.com/library/mongo     <span class="comment">#上传镜像</span></span><br><span class="line">The push refers to repository [www.yunjisuan.com/library/mongo]</span><br><span class="line">8daf1a7ee9a2: Pushed </span><br><span class="line">c718fe180d79: Pushed </span><br><span class="line">56572579bdba: Pushed </span><br><span class="line">df60ba57445a: Pushed </span><br><span class="line">032fcf7da9f7: Pushed </span><br><span class="line">fb77fd3e12e9: Pushed </span><br><span class="line">8fd54ee41170: Pushed </span><br><span class="line">9bbcbe8a46a5: Pushed </span><br><span class="line">b77c8e5e2140: Pushed </span><br><span class="line">428c1ba11354: Pushed </span><br><span class="line">b097f5edab7b: Pushed </span><br><span class="line">27712caf4371: Pushed </span><br><span class="line">8241afc74c6f: Pushed </span><br><span class="line">latest: digest: sha256:e9e97b5cce9bf6d95c79bf3cb23d90e4d79aa8b469854f263fcb18f69af6195a size: 3028</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>浏览器登陆harbor进行查看</strong></p>
<p><img src="/articles/2018/11/15/harborsiyoujingxiangcangku/8.png"></p>
<h3 id="5-7-FAQ：问题解答"><a href="#5-7-FAQ：问题解答" class="headerlink" title="5.7 FAQ：问题解答"></a>5.7 FAQ：问题解答</h3><h4 id="5-7-1-win10版本默认拒绝非认证的域名证书"><a href="#5-7-1-win10版本默认拒绝非认证的域名证书" class="headerlink" title="5.7.1 win10版本默认拒绝非认证的域名证书"></a>5.7.1 win10版本默认拒绝非认证的域名证书</h4><blockquote>
<p>如果启动harbor采用的是https加密证书的方式，最新版win10浏览器访问，会直接提示“站点不安全，拒绝连接”。<br>那么可以采用非https的方式启动harbor</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor-master ssl]# sed -n <span class="string">&#x27;11p&#x27;</span> /data/install/harbor/harbor.cfg</span><br><span class="line">ui_url_protocol = http</span><br><span class="line"><span class="comment">#修改之后要重启harbor。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果采用非https加密方式启动harhor，最新版的docker是登陆不了的，因为新版docker默认以https的方式登陆harbor。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor-master harbor]# docker login -uadmin -pHarbor123456 www.yunjisuan.com</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">Error response from daemon: Get https://www.yunjisuan.com/v2/: unauthorized: authentication required</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>为了解决登陆问题，需要在&#x2F;etc&#x2F;docker下创建一个daemon.josn的名字文件，加入http方式登陆的harbor域名</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor-master harbor]# <span class="built_in">cat</span> /etc/docker/daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>:[ <span class="string">&quot;https://registry.docker-cn.com&quot;</span> ],</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>:[ <span class="string">&quot;www.yunjisuan.com&quot;</span> ]     <span class="comment">#添加此行</span></span><br><span class="line">&#125;</span><br><span class="line">[root@harbor-master harbor]# systemctl restart docker           <span class="comment">#进行重启   </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#再次登陆harbor</span></span><br><span class="line">[root@harbor-master harbor]# docker login -uadmin -pHarbor12345 www.yunjisuan.com</span><br><span class="line">WARNING! Using --password via the CLI is insecure. Use --password-stdin.</span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded     <span class="comment">#登陆成功</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>###附录：harbor更改镜像数据目录方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /&#123;myharbordir&#125;/common/templates/registry</span><br><span class="line">vim config.yml</span><br><span class="line">version: 0.1</span><br><span class="line"><span class="built_in">log</span>:</span><br><span class="line">  level: debug</span><br><span class="line">  fields:</span><br><span class="line">    service: registry</span><br><span class="line">storage:                <span class="comment">#此字段为数据存放位置字段，下面我把数据存储在S3 bucket</span></span><br><span class="line">    cache:</span><br><span class="line">        layerinfo: inmemory</span><br><span class="line">    filesystem:</span><br><span class="line">        rootdirectory: /storage</span><br><span class="line">    maintenance:</span><br><span class="line">        uploadpurging:</span><br><span class="line">            enabled: <span class="literal">false</span></span><br><span class="line">    delete:</span><br><span class="line">        enabled: <span class="literal">true</span></span><br><span class="line">http:</span><br><span class="line">    addr: :5000</span><br><span class="line">    secret: placeholder</span><br><span class="line">    debug:</span><br><span class="line">        addr: localhost:5001</span><br><span class="line">auth:</span><br><span class="line">  token:</span><br><span class="line">    issuer: harbor-token-issuer</span><br><span class="line">    realm: <span class="variable">$ui_url</span>/service/token</span><br><span class="line">    rootcertbundle: /etc/registry/root.crt</span><br><span class="line">    service: harbor-registry</span><br><span class="line"></span><br><span class="line">notifications:</span><br><span class="line">  endpoints:</span><br><span class="line">      - name: harbor</span><br><span class="line">        disabled: <span class="literal">false</span></span><br><span class="line">        url: http://ui/service/notifications</span><br><span class="line">        <span class="built_in">timeout</span>: 3000ms</span><br><span class="line">        threshold: 5</span><br><span class="line">        backoff: 1s</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="comment">#修改后文件内容：</span></span><br><span class="line">[root@gago-harbor-airflow registry]# <span class="built_in">cat</span> config.yml </span><br><span class="line">version: 0.1</span><br><span class="line"><span class="built_in">log</span>:</span><br><span class="line">  level: debug</span><br><span class="line">  fields:</span><br><span class="line">    service: registry</span><br><span class="line">storage:</span><br><span class="line">  s3:</span><br><span class="line">    accesskey: xxxxxx</span><br><span class="line">    secretkey: xxxxxx</span><br><span class="line">    region: cn-north-1</span><br><span class="line">    bucket: xxxxxx</span><br><span class="line">http:</span><br><span class="line">    addr: :5000</span><br><span class="line">    secret: placeholder</span><br><span class="line">    debug:</span><br><span class="line">        addr: localhost:5001</span><br><span class="line">auth:</span><br><span class="line">  token:</span><br><span class="line">    issuer: harbor-token-issuer</span><br><span class="line">    realm: <span class="variable">$ui_url</span>/service/token</span><br><span class="line">    rootcertbundle: /etc/registry/root.crt</span><br><span class="line">    service: harbor-registry</span><br><span class="line"></span><br><span class="line">notifications:</span><br><span class="line">  endpoints:</span><br><span class="line">      - name: harbor</span><br><span class="line">        disabled: <span class="literal">false</span></span><br><span class="line">        url: http://ui/service/notifications</span><br><span class="line">        <span class="built_in">timeout</span>: 3000ms</span><br><span class="line">        threshold: 5</span><br><span class="line">        backoff: 1s</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://kkabuzs.github.io">Kkabuzs</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://kkabuzs.github.io/articles/2018/11/15/harborsiyoujingxiangcangku/">https://kkabuzs.github.io/articles/2018/11/15/harborsiyoujingxiangcangku/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://kkabuzs.github.io" target="_blank">kkabuzs博客屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post-share"><div class="social-share" data-image="/themes-img/touxiang.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/articles/2018/10/14/dockerjichu-xia/" title="Docker基础（下）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Docker基础（下）</div></div><div class="info-2"><div class="info-item-1"> 无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。  Docker基础（下）五，网络管理5.1 容器网络模式  Docker支持5种网络模式  bridge  默认网络，Docker启动后默认创建一个docker0网桥，默认创建的容器也是添加到这个网桥中   host  容器不会获得一个独立的network namespace，而是与宿主机共用一个   none  获取独立的network namespace，但不为容器进行任何网络配置   container  与指定的容器使用同一个network namespace，网卡配置也都是相同的   自定义  自定义网桥，默认与bridge网络一样      5.1.1 bridge网络类型123456789101112131415161718192021222324252627282930313233343536373839404142#安装bridge管理工具[root@localhost ~]# yum -y install...</div></div></div></a><a class="pagination-related" href="/articles/2018/11/21/kuberneteszhivolumeguazai/" title="Kubernetes之Volume挂载"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Kubernetes之Volume挂载</div></div><div class="info-2"><div class="info-item-1"> 无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。  Kubernetes之Volume挂载一，Volume Container中的磁盘文件是短暂的，这在容器中运行时会给非平凡的应用程序带来一些问题。首先，当容器崩溃时，kubelet将重新启动它，但文件将丢失，Container以干净状态启动。其次，当在一起运行Container时，Pod通常需要在这些容器之间共享文件。Kubernetes Volume抽象解决了这两个问题。  1.1...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/articles/2018/10/02/dockerjichu-shang/" title="Docker基础（上）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-02</div><div class="info-item-2">Docker基础（上）</div></div><div class="info-2"><div class="info-item-1"> 无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。  Docker基础（上）一，Docker简介，功能特性与应用场景1.1 Docker简介  Docker是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的Linux机器上，也可以实现虚拟化，容器是完全使用沙箱机制，相互之间不会有任何接口。  一个完整的Docker有以下几个部分组成：  Docker Client 客户端 Docker Daemon 守护进程 Docker Image 镜像 Docker Container 容器    1.2 Docker功能特性  隔离环境（系统，网络，文件系统）与应用  解决依赖与版本问题  易于分发，开箱即用  节点与容器快速扩容  镜像制作简单便捷，管理方便  （1）隔离    通过cgroup（隔离和跟踪资源的使用）&amp;...</div></div></div></a><a class="pagination-related" href="/articles/2018/10/14/dockerjichu-xia/" title="Docker基础（下）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-14</div><div class="info-item-2">Docker基础（下）</div></div><div class="info-2"><div class="info-item-1"> 无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。  Docker基础（下）五，网络管理5.1 容器网络模式  Docker支持5种网络模式  bridge  默认网络，Docker启动后默认创建一个docker0网桥，默认创建的容器也是添加到这个网桥中   host  容器不会获得一个独立的network namespace，而是与宿主机共用一个   none  获取独立的network namespace，但不为容器进行任何网络配置   container  与指定的容器使用同一个network namespace，网卡配置也都是相同的   自定义  自定义网桥，默认与bridge网络一样      5.1.1 bridge网络类型123456789101112131415161718192021222324252627282930313233343536373839404142#安装bridge管理工具[root@localhost ~]# yum -y install...</div></div></div></a><a class="pagination-related" href="/articles/2019/04/02/Linux-fei-root-yonghushiyong-docker-dewenti/" title="Linux 下非root用户使用docker的问题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-04-02</div><div class="info-item-2">Linux 下非root用户使用docker的问题</div></div><div class="info-2"><div class="info-item-1"> 无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。  一，解决非root用户使用docker Linux 下非root用户使用docker，如果不需要root权限的话，需要将用户加入到docker组。  12#报错：ERROR: Couldn&#x27;t connect to Docker daemon at http+docker://localunixsocket - is it running?  通常我们使用linux系统的时候，最好是不要直接使用root账号，但是使用Docker的时候，默认又是不能使用非root用户的，关于原因，官方说法如下：   The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can access it with sudo. For...</div></div></div></a><a class="pagination-related" href="/articles/2019/04/23/rong-qi-zhanman-cipan-fuwuqi-he-rongqi-doumeidawenjian/" title="容器占满了磁盘，但虚机和容器内都没有找到大文件"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-04-23</div><div class="info-item-2">容器占满了磁盘，但虚机和容器内都没有找到大文件</div></div><div class="info-2"><div class="info-item-1"> 无论你跑多少距离，放弃很容易，停下来，肉体得到暂时的舒服，但你最终会一无所得。坚持或许很难，但你最后一定会有所收获，跑过的路，永远不会欺骗自己。  一，原因阐述 领导让我排查一下aws服务器磁盘空间已满的问题，但是看不到大文件的存在，看下图：  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697#看根下所有目录的空间占用[root@gago-viirs gago_viirs]# cd /[root@gago-viirs /]# du -sh *0	bin49M	boot0	data0	dev31M	etc52K	home0	lib0	lib640	local0	media2.7G	mnt104K	optdu:...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/themes-img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Kkabuzs</div><div class="author-info-description">学习记录和整理</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">三人行，必有我师！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Harbor%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">Harbor私有镜像仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%EF%BC%8CHarbor%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">一，Harbor简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 基于角色的访问控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 图形化用户界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%AE%A1%E8%AE%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 审计管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E5%9B%BD%E9%99%85%E5%8C%96"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 国际化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-RESTful-API"><span class="toc-number">1.1.5.</span> <span class="toc-text">1.5 RESTful API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-LDAP%E8%AE%A4%E8%AF%81"><span class="toc-number">1.1.6.</span> <span class="toc-text">1.6 LDAP认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-%E9%95%9C%E5%83%8F%E5%A4%8D%E5%88%B6"><span class="toc-number">1.1.7.</span> <span class="toc-text">1.7 镜像复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-%E4%B8%8EClair%E9%9B%86%E6%88%90"><span class="toc-number">1.1.8.</span> <span class="toc-text">1.8 与Clair集成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-9-Notary%E7%AD%BE%E5%90%8D%E5%B7%A5%E5%85%B7"><span class="toc-number">1.1.9.</span> <span class="toc-text">1.9 Notary签名工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8C%E4%B8%BAHarbor%E7%AD%BE%E5%8F%91%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="toc-number">1.2.</span> <span class="toc-text">二，为Harbor签发域名证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%EF%BC%8C%E4%BF%A1%E4%BB%BB%E8%87%AA%E7%AD%BE%E5%8F%91%E7%9A%84%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="toc-number">1.3.</span> <span class="toc-text">三，信任自签发的域名证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%EF%BC%8CHarbor-1-4-%E7%89%88%E6%9C%AC%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="toc-number">1.4.</span> <span class="toc-text">四，Harbor 1.4 版本配置与安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%89%E8%A3%85docker-ce%E7%A4%BE%E5%8C%BA%E7%89%88"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 安装docker-ce社区版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%AE%89%E8%A3%85Harbor%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 下载并安装Harbor私有仓库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%EF%BC%8C%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86%E4%B8%8E%E5%AE%89%E5%85%A8%EF%BC%9A%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E5%92%8C%E9%95%9C%E5%83%8F%E7%AD%BE%E5%90%8D"><span class="toc-number">1.5.</span> <span class="toc-text">五，镜像管理与安全：漏洞扫描和镜像签名</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%B7%BB%E5%8A%A0docker%E5%9B%BD%E5%86%85%E5%85%AC%E6%9C%89%E9%95%9C%E5%83%8F%E6%BA%90"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 添加docker国内公有镜像源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8harbor%E7%A7%81%E6%9C%89%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 重新启动harbor私有镜像仓库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E4%B8%8B%E8%BD%BD%E4%B8%80%E4%B8%AA%E5%85%AC%E6%9C%89%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0%E5%88%B0harbor"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 下载一个公有镜像上传到harbor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E7%99%BB%E9%99%86%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0%E7%BB%93%E6%9E%9C%EF%BC%8C%E5%B9%B6%E6%89%AB%E6%8F%8F%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4 登陆浏览器查看镜像上传结果，并扫描漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E8%AE%BE%E7%BD%AE%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E7%AD%89%E7%BA%A7"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.5 设置镜像安全等级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E4%B8%BAdocker%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E5%8F%91%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="toc-number">1.5.6.</span> <span class="toc-text">5.6 为docker客户端下发域名证书</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-FAQ%EF%BC%9A%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94"><span class="toc-number">1.5.7.</span> <span class="toc-text">5.7 FAQ：问题解答</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-7-1-win10%E7%89%88%E6%9C%AC%E9%BB%98%E8%AE%A4%E6%8B%92%E7%BB%9D%E9%9D%9E%E8%AE%A4%E8%AF%81%E7%9A%84%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">5.7.1 win10版本默认拒绝非认证的域名证书</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/articles/2025/04/22/mongodb-6-0-21-lixian-fenpianjiqun/" title="MongoDB-6.0.21离线分片集群部署">MongoDB-6.0.21离线分片集群部署</a><time datetime="2025-04-21T17:53:44.000Z" title="发表于 2025-04-22 01:53:44">2025-04-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/articles/2025/04/22/mongodb-6-0-21-lixian-fubenjibushu/" title="MongoDB-6.0.21副本集离线部署手册-（Replica Set）副本集模式">MongoDB-6.0.21副本集离线部署手册-（Replica Set）副本集模式</a><time datetime="2025-04-21T17:51:21.000Z" title="发表于 2025-04-22 01:51:21">2025-04-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/articles/2025/04/21/mongodb-6-0-21-lixian-danjiedianbushu/" title="MongoDB-6.0.21离线单节点部署">MongoDB-6.0.21离线单节点部署</a><time datetime="2025-04-21T15:55:06.000Z" title="发表于 2025-04-21 23:55:06">2025-04-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/articles/2023/05/10/jichengyupaisheng/" title="继承与派生">继承与派生</a><time datetime="2023-05-10T05:52:52.000Z" title="发表于 2023-05-10 13:52:52">2023-05-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/articles/2023/05/09/fengzhuang/" title="封装">封装</a><time datetime="2023-05-09T01:37:55.000Z" title="发表于 2023-05-09 09:37:55">2023-05-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By Kkabuzs</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>